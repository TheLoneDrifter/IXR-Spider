<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spider Animation Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        #canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B0E0E6 100%);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .search-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .spider-info-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .block-texture {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-2 drop-shadow-lg">üï∑Ô∏è Spider Animation Viewer</h1>
            <p class="text-xl text-white/90">Search for any player's spider by IGN</p>
        </header>

        <div class="search-container max-w-2xl mx-auto mb-8">
            <div class="flex gap-4">
                <input 
                    type="text" 
                    id="ign-input" 
                    placeholder="Enter player IGN..." 
                    class="flex-1 px-4 py-3 border-2 border-purple-300 rounded-lg focus:outline-none focus:border-purple-500 text-lg"
                >
                <button 
                    id="search-btn" 
                    class="px-8 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold"
                >
                    Search
                </button>
            </div>
            <div id="search-status" class="mt-4 text-center"></div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
            <div>
                <div id="canvas-container">
                    <div id="loading" class="flex items-center justify-center h-full">
                        <div class="text-center">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <p class="text-white text-lg">Search for a player to view their spider</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="spider-info" class="spider-info-card">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Spider Information</h2>
                <div id="spider-details" class="space-y-3">
                    <p class="text-gray-600">No spider data loaded. Search for a player above.</p>
                </div>
            </div>
        </div>

        <div class="mt-8 text-center text-white/80">
            <p>Powered by Minecraft blocks and textures ‚Ä¢ Real-time spider animation</p>
        </div>
    </div>

    <script>
        class SpiderViewer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.spider = null;
                this.animationId = null;
                this.currentData = null;
                
                this.init();
                this.setupEventListeners();
            }
            
            init() {
                const container = document.getElementById('canvas-container');
                
                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = null;
                this.scene.fog = new THREE.Fog(0x87CEEB, 10, 100);
                
                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    container.clientWidth / container.clientHeight, 
                    0.1, 
                    1000
                );
                this.camera.position.set(0, 5, 10);
                this.camera.lookAt(0, 0, 0);
                
                // Renderer setup
                this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(this.renderer.domElement);
                
                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.camera.near = 0.1;
                directionalLight.shadow.camera.far = 50;
                directionalLight.shadow.camera.left = -10;
                directionalLight.shadow.camera.right = 10;
                directionalLight.shadow.camera.top = 10;
                directionalLight.shadow.camera.bottom = -10;
                this.scene.add(directionalLight);
                
                // Ground
                const groundGeometry = new THREE.PlaneGeometry(20, 20);
                const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.receiveShadow = true;
                this.scene.add(ground);
                
                // Start render loop
                this.animate();
                
                // Handle resize
                window.addEventListener('resize', () => this.onWindowResize());
            }
            
            setupEventListeners() {
                const searchBtn = document.getElementById('search-btn');
                const ignInput = document.getElementById('ign-input');
                
                searchBtn.addEventListener('click', () => this.searchPlayer());
                ignInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchPlayer();
                });
            }
            
            async searchPlayer() {
                const ign = document.getElementById('ign-input').value.trim();
                if (!ign) {
                    this.updateStatus('Please enter a player IGN', 'error');
                    return;
                }
                
                this.updateStatus('Searching...', 'loading');
                
                try {
                    const response = await fetch(`/api/spider/player/${encodeURIComponent(ign)}`);
                    const data = await response.json();
                    
                    if (data.found && data.data) {
                        this.currentData = data.data;
                        this.displaySpider(data.data);
                        this.updateStatus(`Found ${ign}'s spider!`, 'success');
                    } else {
                        this.updateStatus(data.error || 'Player not found', 'error');
                        this.clearSpider();
                    }
                } catch (error) {
                    this.updateStatus('Error searching for player', 'error');
                    console.error('Search error:', error);
                }
            }
            
            displaySpider(data) {
                this.clearSpider();
                
                // Create spider based on data
                this.createSpiderModel(data);
                
                // Update info panel
                this.updateSpiderInfo(data);
            }
            
            createSpiderModel(data) {
                const spiderGroup = new THREE.Group();
                
                // Body
                const bodyGeometry = new THREE.BoxGeometry(2, 1, 3);
                const bodyMaterial = this.createBlockMaterial(data.concreteColor === 'WHITE' ? 0xF0F0F0 : 0x2F2F2F);
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.position.y = 1;
                body.castShadow = true;
                spiderGroup.add(body);
                
                // Head
                const headGeometry = new THREE.BoxGeometry(1, 0.8, 1);
                const headMaterial = this.createBlockMaterial(data.concreteColor === 'WHITE' ? 0xF0F0F0 : 0x2F2F2F);
                const head = new THREE.Mesh(headGeometry, headMaterial);
                head.position.set(0, 1.2, 1.5);
                head.castShadow = true;
                spiderGroup.add(head);
                
                // Eyes
                const eyeColor = this.getEyeColor(data.eyeColor);
                const eyeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                const eyeMaterial = new THREE.MeshLambertMaterial({ 
                    color: eyeColor,
                    emissive: eyeColor,
                    emissiveIntensity: 0.3
                });
                
                // Add eyes
                for (let i = -1; i <= 1; i += 2) {
                    const eye = new THREE.Mesh(eyeGeometry, eyeMaterial);
                    eye.position.set(i * 0.3, 1.2, 1.9);
                    spiderGroup.add(eye);
                }
                
                // Legs
                const legMaterial = this.createBlockMaterial(data.concreteColor === 'WHITE' ? 0xF0F0F0 : 0x2F2F2F);
                const legCount = data.legCount;
                const legsPerSide = legCount / 2;
                
                for (let side = 0; side < 2; side++) {
                    for (let i = 0; i < legsPerSide; i++) {
                        const legGroup = new THREE.Group();
                        
                        // Create leg segments
                        for (let j = 0; j < 3; j++) {
                            const segmentGeometry = new THREE.BoxGeometry(0.15, 0.8, 0.15);
                            const segment = new THREE.Mesh(segmentGeometry, legMaterial);
                            segment.position.y = -j * 0.8;
                            segment.castShadow = true;
                            legGroup.add(segment);
                        }
                        
                        // Position leg
                        const sideOffset = side === 0 ? -1 : 1;
                        const spread = (i / (legsPerSide - 1)) * 1.5 - 0.75;
                        legGroup.position.set(sideOffset * (1 + spread), 0.5, -0.5 + i * 0.3);
                        legGroup.rotation.z = sideOffset * 0.3;
                        
                        spiderGroup.add(legGroup);
                    }
                }
                
                this.spider = spiderGroup;
                this.scene.add(spiderGroup);
            }
            
            createBlockMaterial(color) {
                return new THREE.MeshLambertMaterial({ 
                    color: color,
                    transparent: false
                });
            }
            
            getEyeColor(eyeColorName) {
                const colors = {
                    'LIME_EYES': 0x32CD32,
                    'RED_EYES': 0xFF0000,
                    'BLUE_EYES': 0x0000FF,
                    'WHITE_EYES': 0xFFFFFF,
                    'ORANGE_EYES': 0xFFA500,
                    'MAGENTA_EYES': 0xFF00FF,
                    'LIGHT_BLUE_EYES': 0x87CEEB,
                    'YELLOW_EYES': 0xFFFF00,
                    'PINK_EYES': 0xFFC0CB,
                    'GRAY_EYES': 0x808080,
                    'LIGHT_GRAY_EYES': 0xD3D3D3,
                    'CYAN_EYES': 0x00FFFF,
                    'PURPLE_EYES': 0x800080,
                    'BROWN_EYES': 0x8B4513,
                    'GREEN_EYES': 0x008000
                };
                return colors[eyeColorName] || 0x32CD32;
            }
            
            updateSpiderInfo(data) {
                const details = document.getElementById('spider-details');
                const lastSeen = new Date(data.lastSeen).toLocaleString();
                
                details.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Player:</span>
                            <span class="text-gray-900">${data.ign}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Leg Count:</span>
                            <span class="text-gray-900">${data.legCount} legs</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Eye Color:</span>
                            <span class="text-gray-900">${data.eyeColor.replace('_EYES', '')}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Body Color:</span>
                            <span class="text-gray-900">${data.concreteColor}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Fuel Level:</span>
                            <span class="text-gray-900">${data.fuel}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-700">Last Seen:</span>
                            <span class="text-gray-900">${lastSeen}</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: ${data.fuel}%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Fuel Level</p>
                    </div>
                `;
            }
            
            clearSpider() {
                if (this.spider) {
                    this.scene.remove(this.spider);
                    this.spider = null;
                }
            }
            
            updateStatus(message, type) {
                const status = document.getElementById('search-status');
                const colors = {
                    loading: 'text-blue-600',
                    success: 'text-green-600',
                    error: 'text-red-600'
                };
                
                status.className = `mt-4 text-center ${colors[type] || 'text-gray-600'}`;
                status.textContent = message;
            }
            
            animate() {
                this.animationId = requestAnimationFrame(() => this.animate());
                
                // Animate spider
                if (this.spider) {
                    const time = Date.now() * 0.001;
                    this.spider.rotation.y = Math.sin(time * 0.5) * 0.1;
                    this.spider.position.y = Math.sin(time * 2) * 0.1 + 0.5;
                }
                
                this.renderer.render(this.scene, this.camera);
            }
            
            onWindowResize() {
                const container = document.getElementById('canvas-container');
                this.camera.aspect = container.clientWidth / container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }
        
        // Initialize viewer when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SpiderViewer();
        });
    </script>
</body>
</html>
